@model MvcMember.Models.Complain
@{
    ViewBag.Title = "修改客户意见投诉";
}
<h2 id="hdtxt">修改客户意见投诉</h2>

<form id="firstform" action="">
    <div id="contentdiv">
        <div class="formdiv">
        <input type="hidden" value="@ViewBag.DmsID" id="dmsid" />
        <input type="hidden" value="@ViewBag.UserID" id="userid" />
        <input type="hidden" value="@ViewBag.Tag" id="tag" />
        <input type="hidden" value="@ViewBag.ID" id="id" />
        <input type="hidden" value="@Model.ComeType" id="hidComeType" />
        <input type="hidden" value="@Model.Type" id="hidType" />
        <div class="headp" style="margin-bottom:8px;">　填写客户意见投诉信息</div>
        <table>
        <tr>
            <td class="labtd">*车牌号码:</td>
            <td><input type="text" id="CarNO" name="CarNO" value="@Model.CarNO" datatype="s" nullmsg="请输入车牌号码！"  errormsg="请输入车牌号码！"/></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd"> *客户名称:</td>
            <td><input type="text" id="Customer" name="Customer" value="@Model.Customer" datatype="s" nullmsg="请输入客户名称！"  errormsg="请输入客户名称！"/></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd">*联系电话:</td>
            <td><input type="text" id="Mobile" name="Mobile" value="@Model.Mobile" datatype="n" nullmsg="请输入联系电话！"  errormsg="请输入联系电话！"/></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd">*投诉方式:</td>
            <td><input type="radio" datatype="radio" class="pr1" id="tsfs1" name="tsfs" checked="checked" value="1" /><label for="male">打电话</label>
             <input type="radio" class="pr1" id="tsfs2" name="tsfs" value="2" /><label for="female">来店</label></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd">*时间:</td>
            <td><input type="text" id="CTime" value="@Model.CTime.ToShortDateString()" name="CTime" /></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd">*事发地点:</td>
            <td><input type="text" id="Site" value="@Model.Site" name="Site" /></td>
            <td></td>
        </tr>
        <tr>
            <td class="labtd">投诉对象:</td>
            <td><input type="text" id="Person" value="@Model.Person" name="Person" /></td>
            <td></td>
        </tr>
        <tr>
            <td class="labtd"> *投诉内容:</td>
            <td><textarea  cols="40" rows="2" id="Event" style="font-size:90%;" name="Event">@Model.Event </textarea></td>
            
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd">*投诉类型:</td>
            <td><input type="radio" datatype="radio" class="pr1" id="tslx1" name="tslx" checked="checked" value="1" /><label for="tslx1">抱怨</label>
             <input type="radio" class="pr1" id="tslx2" name="tslx" value="2" /><label for="tslx2">意见</label>
             <input type="radio" class="pr1" id="tslx3" name="tslx" value="3" /><label for="tslx3">建议</label>
             </td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd"> 投诉性质:</td>
            <td>@Html.DropDownList("EventType", new SelectList(ViewBag.EventType as System.Collections.IEnumerable,
                 "ItemName", "ItemName", Model.EventType)) </td>
            <td></td>
        </tr>


        <tr>
            <td class="labtd">处理时间:</td>
            <td><input type="text" id="HandleTime" value="@Model.HandleTime" name="HandleTime" /></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>
        <tr>
            <td class="labtd">处理人:</td>
            <td><input type="text" id="HandleMan" value="@Model.HandleMan" name="HandleMan" /></td>
            <td><div class="Validform_checktip"></div></td>
        </tr>

        <tr id="clyj">
            <td class="labtd"> 处理意见:</td>
            <td><textarea  cols="40" rows="2" id="txtclyj" style="font-size:90%;" name="Event">@Model.Handle </textarea></td>
            
            <td><div class="Validform_checktip"></div></td>
        </tr>

        <tr>
            <td class="labtd"></td>
            <td class="baidubtn"><a href="javascript:void(0)" style="margin-left:0px; float:left;" onclick="Commit()">保 存</a></td>
            <td class="baidubtn"></td>
        </tr>

        </table>
        </div>
        <div style="clear:both;"></div>
    </div>
</form>
<div style=" padding-bottom:10px; padding-left:5px;">
    　　@Html.ActionLink("返回列表", "ComplainList")
 </div>
<script src="@Url.Content("~/Scripts/jquery.ui.autocomplete.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.ui.position.js")" type="text/javascript"></script>
 <script type="text/javascript">
     $(document).ready(function () {
         $("#Mobile").numeral();
         $("#CTime").datepicker();
         $("#HandleTime").datepicker();
         $('#firstform').bind('keypress', function (e) {
             return e.keyCode !== 13;
         });
         if ($("#hidComeType").val() == "来店") {
             $("#tsfs2").attr("checked", "checked");
         }
         if ($("#hidType").val() == "意见") {
             $("#tslx2").attr("checked", "checked");
         }
         if ($("#hidType").val() == "建议") {
             $("#tslx3").attr("checked", "checked");
         }
         //修改
         if ($("#tag").val() == "0") {
             $("#clyj").hide();
             $("#HandleTime").hide();
             $("#HandleMan").hide();
         }
         //查看、处理投诉
         if ($("#tag").val() == "1" || $("#tag").val() == "-1") {
             $(".formdiv input[type='text']").attr("disabled", "disabled");
             $(".formdiv select").attr("disabled", "disabled");
             $(".formdiv textarea").attr("disabled", "disabled");

             $("#hdtxt").text("查看客户投诉详情！")
             if ($("#tag").val() == "-1") {
                 $("#txtclyj").removeAttr("disabled");
                 $("#HandleTime").removeAttr("disabled");
                 $("#HandleMan").removeAttr("disabled");
                 $("#hdtxt").text("处理客户投诉意见！")
                 $("#HandleMan").val($("#userid").val());
             }
         }
         //输入框鼠标样式
         $(".formdiv input[type='text']").bind("mouseover", function () {
             $(this).css("border", "1px solid #FFAA00");
         });
         $(".formdiv select").bind("mouseover", function () {
             $(this).css("border", "1px solid #FFAA00");
         });
         $(".formdiv input[type='text']").bind("mouseout", function () {
             $(this).css("border", "1px solid #CCCCCC");
         });
         $(".formdiv select").bind("mouseout", function () {
             $(this).css("border", "1px solid #CCCCCC");
         });
         $("#firstform").Validform({
             tiptype: 2,
             postonce: true,
             ajaxPost: true,
             callback: function (data) {
                 if (data.status == "y") {
                     setTimeout(function () {
                         $.Hidemsg(); //公用方法关闭信息提示框;
                     }, 2000);
                 }
             }
         });
     });
     function Commit() {
         if ($("#tag").val() == "1") {
             return;
         }
         if ($("#Customer").val() == "" || $("#CarNO").val() == "" || $("#Mobile").val() == "") {
             return false;
         }
         var cometype = '打电话';
         if ($("#tsfs2").attr("checked") == true) {
             cometype = "来店";
         }
         var Type = '抱怨';
         if ($("#tslx2").attr("checked") == true) {
             Type = "意见";
         }
         if ($("#tslx3").attr("checked") == true) {
             Type = "建议";
         }
         $.ajax({
             type: 'post',
             url: '@Url.Content("../../../AjaxServiceSave.svc/UpdateComplain")',
             contentType: 'application/json',
             dataType: 'text',
             data: '{"id":"' + $("#id").val() + '","customer":"' + $("#Customer").val() + '","carno":"' + $("#CarNO").val() + '","mobile":"' + $("#Mobile").val() + '","cometype":"' + cometype + '","ctime":"' + $("#CTime").val() + '","site":"' + $("#Site").val() + '","person":"' + $("#Person").val() + '","events":"' + $("#Event").val() + '","type":"' + Type + '","eventtype":"' + $("#EventType").val() + '","handle":"' + $("#txtclyj").val() + '","handleman":"' + $("#HandleMan").val() + '","userid":"' + $("#userid").val() + '","dmsid":"' + $("#dmsid").val() + '"}',
             success: function (msg) {
                 var a = eval('(' + msg + ')');
                 if (a.d == 1) {
                     alert("保存成功！");
                 }
                 else
                 {
                     alert("保存失败！");
                 }
             },
             error: function () {
                 alert("发生错误！");
             },
             beforeSend: function () {
                 $(".baidubtn a:first").text("正在保存...");
             },
             complete: function () {
                 $(".baidubtn a:first").text("保 存");
             }
         });
     }
     function Print() {
        
     }
</script>

